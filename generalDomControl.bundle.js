/******/ (() => { // webpackBootstrap
/******/ 	"use strict";
/******/ 	var __webpack_modules__ = ({

/***/ "./src/category.js":
/*!*************************!*\
  !*** ./src/category.js ***!
  \*************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ Category)
/* harmony export */ });
// Categories

class Category {
  constructor(categoryname) {
    this.categoryname = categoryname;
  }
}


/***/ }),

/***/ "./src/task2.js":
/*!**********************!*\
  !*** ./src/task2.js ***!
  \**********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ TTask)
/* harmony export */ });
class TTask {
  constructor(name, description, dueDate = "", priority, category, id) {
    this.name = name;
    this.description = description;
    this.dueDate = dueDate;
    this.priority = priority;
    this.category = category;
    this.id = id;
  }

  setName(name) {
    this.name = name;
  }

  getName() {
    return this.name;
  }

  setDescription(description) {
    this.description = description;
  }

  getDescription() {
    return this.description;
  }

  setDate(dueDate) {
    this.dueDate = dueDate;
  }

  getDate() {
    return this.dueDate;
  }

  setPriority(priority) {
    this.priority = priority;
  }

  getPriority() {
    return this.priority;
  }

  setCategory(category) {
    this.category = category;
  }

  getCategory() {
    return this.category;
  }

  setID() {
    this.id = id;
  }

  getID() {
    return this.id;
  }
}


/***/ }),

/***/ "./src/imgs/half-moon.png":
/*!********************************!*\
  !*** ./src/imgs/half-moon.png ***!
  \********************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

module.exports = __webpack_require__.p + "b26bbb069793f6c0827c.png";

/***/ }),

/***/ "./src/imgs/sunpixel.png":
/*!*******************************!*\
  !*** ./src/imgs/sunpixel.png ***!
  \*******************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

module.exports = __webpack_require__.p + "a6c1c2d669d369ef5d38.png";

/***/ })

/******/ 	});
/************************************************************************/
/******/ 	// The module cache
/******/ 	var __webpack_module_cache__ = {};
/******/ 	
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/ 		// Check if module is in cache
/******/ 		var cachedModule = __webpack_module_cache__[moduleId];
/******/ 		if (cachedModule !== undefined) {
/******/ 			return cachedModule.exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = __webpack_module_cache__[moduleId] = {
/******/ 			// no module.id needed
/******/ 			// no module.loaded needed
/******/ 			exports: {}
/******/ 		};
/******/ 	
/******/ 		// Execute the module function
/******/ 		__webpack_modules__[moduleId](module, module.exports, __webpack_require__);
/******/ 	
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/ 	
/************************************************************************/
/******/ 	/* webpack/runtime/define property getters */
/******/ 	(() => {
/******/ 		// define getter functions for harmony exports
/******/ 		__webpack_require__.d = (exports, definition) => {
/******/ 			for(var key in definition) {
/******/ 				if(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {
/******/ 					Object.defineProperty(exports, key, { enumerable: true, get: definition[key] });
/******/ 				}
/******/ 			}
/******/ 		};
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/global */
/******/ 	(() => {
/******/ 		__webpack_require__.g = (function() {
/******/ 			if (typeof globalThis === 'object') return globalThis;
/******/ 			try {
/******/ 				return this || new Function('return this')();
/******/ 			} catch (e) {
/******/ 				if (typeof window === 'object') return window;
/******/ 			}
/******/ 		})();
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/hasOwnProperty shorthand */
/******/ 	(() => {
/******/ 		__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/make namespace object */
/******/ 	(() => {
/******/ 		// define __esModule on exports
/******/ 		__webpack_require__.r = (exports) => {
/******/ 			if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 				Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 			}
/******/ 			Object.defineProperty(exports, '__esModule', { value: true });
/******/ 		};
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/publicPath */
/******/ 	(() => {
/******/ 		var scriptUrl;
/******/ 		if (__webpack_require__.g.importScripts) scriptUrl = __webpack_require__.g.location + "";
/******/ 		var document = __webpack_require__.g.document;
/******/ 		if (!scriptUrl && document) {
/******/ 			if (document.currentScript)
/******/ 				scriptUrl = document.currentScript.src
/******/ 			if (!scriptUrl) {
/******/ 				var scripts = document.getElementsByTagName("script");
/******/ 				if(scripts.length) scriptUrl = scripts[scripts.length - 1].src
/******/ 			}
/******/ 		}
/******/ 		// When supporting browsers where an automatic publicPath is not supported you must specify an output.publicPath manually via configuration
/******/ 		// or pass an empty string ("") and set the __webpack_public_path__ variable from your code to use your own logic.
/******/ 		if (!scriptUrl) throw new Error("Automatic publicPath is not supported in this browser");
/******/ 		scriptUrl = scriptUrl.replace(/#.*$/, "").replace(/\?.*$/, "").replace(/\/[^\/]+$/, "/");
/******/ 		__webpack_require__.p = scriptUrl;
/******/ 	})();
/******/ 	
/************************************************************************/
var __webpack_exports__ = {};
// This entry need to be wrapped in an IIFE because it need to be isolated against other modules in the chunk.
(() => {
/*!***************************!*\
  !*** ./src/generalDom.js ***!
  \***************************/
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "initialLoad": () => (/* binding */ initialLoad)
/* harmony export */ });
/* harmony import */ var _task2__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./task2 */ "./src/task2.js");
/* harmony import */ var _category__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./category */ "./src/category.js");
/* harmony import */ var _imgs_half_moon_png__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./imgs/half-moon.png */ "./src/imgs/half-moon.png");
/* harmony import */ var _imgs_sunpixel_png__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./imgs/sunpixel.png */ "./src/imgs/sunpixel.png");






let selectedCategory = "all tasks";
let nameImput = document.getElementById("name");
let themeIcon = document.getElementById("icon");
let info = document.querySelector(".info");
let addTaskButton = document.querySelector(".create");
let taskModal = document.querySelector(".modal-bg");
let modalClose = document.querySelector(".modal-close");
let taskSubmitButton = document.querySelector("#submitTask");
let categoryInput = document.getElementById("category");
let categoryButton = document.querySelectorAll("[category]");
let deleteCategoryButtons = document.querySelectorAll(".categorydelete");

const initialLoad = (() => {
  window.addEventListener("load", () => {
    // Initial Date Update
    let initialDate = new Date();
    let initalTime = initialDate.toLocaleTimeString();
    info.textContent = `It's ${initialDate.toDateString()}, ${initalTime}`;

    // Storage

    // UserName

    const userName = localStorage.getItem("userName") || "";
    nameImput.value = userName;

    nameImput.addEventListener("change", (e) => {
      localStorage.setItem("userName", e.target.value);
    });

    // Theme

    if (localStorage.getItem("theme") == "dark-theme") {
      document.body.classList.toggle("dark-theme");
      themeIcon.src = _imgs_sunpixel_png__WEBPACK_IMPORTED_MODULE_3__;
    } else {
      localStorage.setItem("theme", "normal");
      themeIcon.src = _imgs_half_moon_png__WEBPACK_IMPORTED_MODULE_2__;
    }

    // Theme Changer

    themeIcon.onclick = function () {
      document.body.classList.toggle("dark-theme");
      if (document.body.classList.contains("dark-theme")) {
        themeIcon.src = _imgs_sunpixel_png__WEBPACK_IMPORTED_MODULE_3__;
        localStorage.setItem("theme", "dark-theme");
      } else {
        themeIcon.src = _imgs_half_moon_png__WEBPACK_IMPORTED_MODULE_2__;
        localStorage.setItem("theme", "normal");
      }
    };

    //Category Input

    categoryInput.addEventListener("change", (e) => {
      let current = new _category__WEBPACK_IMPORTED_MODULE_1__["default"](e.target.value);
      let currentCategoriesInStorage = JSON.parse(
        localStorage.getItem("categories")
      );
      let categories = currentCategoriesInStorage;
      categories.push(current);
      selectedCategory = e.target.value;
      categoryInput.value = "";
      localStorage.setItem("categories", JSON.stringify(categories));

      renderCategories();
      updateDom();
      changeSelectedOnScreenCSS();
    });

    // Open Add Task Modal

    addTaskButton.addEventListener("click", function (e) {
      taskModal.classList.add("active");
    });

    // Close Modal

    modalClose.addEventListener("click", function (e) {
      taskModal.classList.remove("active");
    });

    // Update Time
    setInterval(function getDisplayTime() {
      let currentDate = new Date();
      let currentTime = currentDate.toLocaleTimeString();
      info.textContent = `It's ${currentDate.toDateString()}, ${currentTime}`;
    }, 1000);
  });

  // Category Switcher
})();

// Load Categories to DOM

function loadCategories() {
  if (localStorage.getItem("categories")) {
  } else {
    localStorage.setItem(
      "categories",
      JSON.stringify([{ categoryname: "all tasks" }])
    );
  }
  renderCategories();
}

loadCategories();

// Load Tasks

function loadTasks() {
  if (localStorage.getItem("tasks")) {
  } else {
    localStorage.setItem("tasks", JSON.stringify([]));
  }
}

loadTasks();

// Task Submit to Create Task

taskSubmitButton.addEventListener("click", function (ev) {
  ev.preventDefault();

  let taskinput = document.querySelector("#taskinput");
  let taskinputDescription = document.querySelector("#descinput");
  let taskinputDue = document.querySelector("#duedate");
  let taskinputPriority = document.querySelector(
    'input[name="priority"]:checked'
  );

  let tasklength = taskinput.value.length;
  let id = Math.floor(Math.random() * 1000000);
  if (tasklength >= 1) {
    let currentCreateTask = new _task2__WEBPACK_IMPORTED_MODULE_0__["default"](
      taskinput.value,
      taskinputDescription.value,
      taskinputDue.value,
      taskinputPriority.value,
      selectedCategory,
      id
    );

    let currentTasksInStorage = JSON.parse(localStorage.getItem("tasks"));

    let tasks = currentTasksInStorage;

    tasks.push(currentCreateTask);

    localStorage.setItem("tasks", JSON.stringify(tasks));

    taskinput.value = null;
    taskinputDescription.value = null;
    taskinputDue.value = null;

    taskModal.classList.remove("active");
  } else {
    taskModal.classList.remove("active");
  }
  renderTasks(selectedCategory);
});

// Render Categories

function renderCategories() {
  const categoryDisplay = document.querySelector(".category-display");
  deleteCategories(categoryDisplay);
  let currentCategories = JSON.parse(localStorage.getItem("categories"));
  currentCategories.forEach((element) => {
    let categoryButton = document.createElement("button");
    categoryButton.classList.add("category");
    categoryButton.setAttribute("category", `${element.categoryname}`);
    categoryButton.innerText = element.categoryname;
    if (element.categoryname != "all tasks") {
      let categoryDeleteSpan = document.createElement("span");
      categoryDeleteSpan.classList.add("categorydelete");
      categoryDeleteSpan.setAttribute("id", element.categoryname);
      categoryDeleteSpan.innerText = "X";
      categoryButton.appendChild(categoryDeleteSpan);
    }
    categoryDisplay.appendChild(categoryButton);
  });
  updateDom();
  addCategorySwitcher();
  categoryDeleteListener();
}

// update Category Selectors and Loaders

function updateDom() {
  nameImput = document.getElementById("name");
  themeIcon = document.getElementById("icon");
  info = document.querySelector(".info");
  addTaskButton = document.querySelector(".create");
  taskModal = document.querySelector(".modal-bg");
  modalClose = document.querySelector(".modal-close");
  taskSubmitButton = document.querySelector("#submitTask");
  categoryInput = document.getElementById("category");
  categoryButton = document.querySelectorAll("[category]");
  deleteCategoryButtons = document.querySelectorAll(".categorydelete");
}

// Delete Existing Categories
function deleteCategories(x) {
  while (x.firstChild) {
    x.removeChild(x.firstChild);
  }
}

function changeSelectedOnScreenCSS() {
  categoryButton.forEach((button) => {
    if (button.getAttribute("category") == selectedCategory) {
      button.classList.add("selectedView");
      renderTasks(selectedCategory);
    } else {
      button.classList.remove("selectedView");
    }
  });
}

function addCategorySwitcher() {
  categoryButton.forEach((button) => {
    button.addEventListener("click", (e) => {
      selectedCategory = e.target.getAttribute("category");
      changeSelectedOnScreenCSS();
    });
  });
}

changeSelectedOnScreenCSS();

function categoryDeleteListener() {
  deleteCategoryButtons.forEach((button) => {
    button.addEventListener("click", (e) => {
      selectedCategory = "all tasks";
      deleteCategory(e);
    });
  });
}

function deleteCategory(e) {
  const currentCategories = JSON.parse(localStorage.getItem("categories"));
  const selectedCategory = e.target.id;
  let count = 0;
  currentCategories.forEach((category) => {
    if (category.categoryname == selectedCategory) {
      currentCategories.splice(count, 1);
    } else {
      count++;
    }
  });
  localStorage.setItem("categories", JSON.stringify(currentCategories));
  renderCategories();
  deleteOnScreenTasks();
}

function renderTasks(e) {
  deleteOnScreenTasks();
  const tasks = JSON.parse(localStorage.getItem("tasks"));
  const taskDisplay = document.querySelector(".taskdisplay");
  tasks.forEach((task) => {
    if (selectedCategory == "all tasks") {
      let taskbox = document.createElement("div");
      taskbox.classList.add("task");

      let taskgeneral = document.createElement("div");
      taskgeneral.classList.add("taskgeneral");

      let tasktitle = document.createElement("div");
      tasktitle.classList.add("tasktitle");
      tasktitle.innerText = `${task.name}`;

      let taskdescription = document.createElement("div");
      taskdescription.classList.add("taskdescription");
      taskdescription.innerText = `${task.description}`;

      taskgeneral.appendChild(tasktitle);
      taskgeneral.appendChild(taskdescription);
      taskbox.appendChild(taskgeneral);

      let taskinfo = document.createElement("div");
      taskinfo.classList.add("taskinfo");

      let taskpriority = document.createElement("div");
      taskpriority.classList.add("taskpriority");
      taskpriority.innerText = task.priority;

      let taskdate = document.createElement("div");
      taskdate.classList.add("taskdate");
      taskdate.innerText = task.dueDate;

      taskinfo.appendChild(taskpriority);
      taskinfo.appendChild(taskdate);

      taskbox.appendChild(taskinfo);

      let deletebutton = document.createElement("button");
      deletebutton.setAttribute("id", task.id);
      deletebutton.classList.add("deletetaskbutton");
      deletebutton.innerText = "Delete";

      // let editButton = document.createElement("button");
      // editButton.setAttribute("id", task.id);
      // editButton.classList.add("edittaskbutton");
      // editButton.innerText = "Edit";

      let taskcategorydisplay = document.createElement("span");
      taskcategorydisplay.innerText = task.category;
      taskcategorydisplay.classList.add("taskcategorydisplay");

      taskbox.appendChild(deletebutton);
      // taskbox.appendChild(editButton);
      taskbox.appendChild(taskcategorydisplay);

      taskDisplay.appendChild(taskbox);

      addTaskEventListeners();
    } else if (task.category == selectedCategory) {
      let taskbox = document.createElement("div");
      taskbox.classList.add("task");

      let taskgeneral = document.createElement("div");
      taskgeneral.classList.add("taskgeneral");

      let tasktitle = document.createElement("div");
      tasktitle.classList.add("tasktitle");
      tasktitle.innerText = `${task.name}`;

      let taskdescription = document.createElement("div");
      taskdescription.classList.add("taskdescription");
      taskdescription.innerText = `${task.description}`;

      taskgeneral.appendChild(tasktitle);
      taskgeneral.appendChild(taskdescription);
      taskbox.appendChild(taskgeneral);

      let taskinfo = document.createElement("div");
      taskinfo.classList.add("taskinfo");

      let taskpriority = document.createElement("div");
      taskpriority.classList.add("taskpriority");
      taskpriority.innerText = task.priority;

      let taskdate = document.createElement("div");
      taskdate.classList.add("taskdate");
      taskdate.innerText = task.dueDate;

      taskinfo.appendChild(taskpriority);
      taskinfo.appendChild(taskdate);

      taskbox.appendChild(taskinfo);

      let deletebutton = document.createElement("button");
      deletebutton.setAttribute("id", task.id);
      deletebutton.classList.add("deletetaskbutton");
      deletebutton.innerText = "Delete";

      // let editButton = document.createElement("button");
      // editButton.setAttribute("id", task.id);
      // editButton.classList.add("edittaskbutton");
      // editButton.innerText = "Edit";

      let taskcategorydisplay = document.createElement("span");
      taskcategorydisplay.innerText = task.category;
      taskcategorydisplay.classList.add("taskcategorydisplay");

      taskbox.appendChild(deletebutton);
      // taskbox.appendChild(editButton);
      taskbox.appendChild(taskcategorydisplay);

      taskDisplay.appendChild(taskbox);
      updateDom();
      addTaskEventListeners();
    }
  });
}

function deleteTask(e) {
  const ID = e.target.getAttribute("id");
  const tasks = JSON.parse(localStorage.getItem("tasks"));
  const newTasks = tasks.filter((task) => task.id != ID);
  localStorage.setItem("tasks", JSON.stringify(newTasks));
  renderTasks();
}

// function editTask(e) {}

function deleteOnScreenTasks() {
  const taskDisplay = document.querySelector(".taskdisplay");
  while (taskDisplay.firstChild) {
    taskDisplay.removeChild(taskDisplay.firstChild);
  }
}

function addTaskEventListeners() {
  let deleteButtons = document.querySelectorAll(".deletetaskbutton");
  // let editButtons = document.querySelectorAll(".edittaskbutton");
  deleteButtons.forEach((button) => {
    button.addEventListener("click", (e) => {
      deleteTask(e);
    });
  });

  // editButtons.forEach((button) => {
  //   button.addEventListener("click", (e) => {
  //     console.log(e.target.getAttribute("id") + " edit");
  //   });
  // });
}



})();

/******/ })()
;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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OztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQSxRQUFRO0FBQ1IsTUFBTTtBQUNOOztBQUV1QiIsInNvdXJjZXMiOlsid2VicGFjazovL3RvZG9fYXBwLy4vc3JjL2NhdGVnb3J5LmpzIiwid2VicGFjazovL3RvZG9fYXBwLy4vc3JjL3Rhc2syLmpzIiwid2VicGFjazovL3RvZG9fYXBwL3dlYnBhY2svYm9vdHN0cmFwIiwid2VicGFjazovL3RvZG9fYXBwL3dlYnBhY2svcnVudGltZS9kZWZpbmUgcHJvcGVydHkgZ2V0dGVycyIsIndlYnBhY2s6Ly90b2RvX2FwcC93ZWJwYWNrL3J1bnRpbWUvZ2xvYmFsIiwid2VicGFjazovL3RvZG9fYXBwL3dlYnBhY2svcnVudGltZS9oYXNPd25Qcm9wZXJ0eSBzaG9ydGhhbmQiLCJ3ZWJwYWNrOi8vdG9kb19hcHAvd2VicGFjay9ydW50aW1lL21ha2UgbmFtZXNwYWNlIG9iamVjdCIsIndlYnBhY2s6Ly90b2RvX2FwcC93ZWJwYWNrL3J1bnRpbWUvcHVibGljUGF0aCIsIndlYnBhY2s6Ly90b2RvX2FwcC8uL3NyYy9nZW5lcmFsRG9tLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIENhdGVnb3JpZXNcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgQ2F0ZWdvcnkge1xuICBjb25zdHJ1Y3RvcihjYXRlZ29yeW5hbWUpIHtcbiAgICB0aGlzLmNhdGVnb3J5bmFtZSA9IGNhdGVnb3J5bmFtZTtcbiAgfVxufVxuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgVFRhc2sge1xuICBjb25zdHJ1Y3RvcihuYW1lLCBkZXNjcmlwdGlvbiwgZHVlRGF0ZSA9IFwiXCIsIHByaW9yaXR5LCBjYXRlZ29yeSwgaWQpIHtcbiAgICB0aGlzLm5hbWUgPSBuYW1lO1xuICAgIHRoaXMuZGVzY3JpcHRpb24gPSBkZXNjcmlwdGlvbjtcbiAgICB0aGlzLmR1ZURhdGUgPSBkdWVEYXRlO1xuICAgIHRoaXMucHJpb3JpdHkgPSBwcmlvcml0eTtcbiAgICB0aGlzLmNhdGVnb3J5ID0gY2F0ZWdvcnk7XG4gICAgdGhpcy5pZCA9IGlkO1xuICB9XG5cbiAgc2V0TmFtZShuYW1lKSB7XG4gICAgdGhpcy5uYW1lID0gbmFtZTtcbiAgfVxuXG4gIGdldE5hbWUoKSB7XG4gICAgcmV0dXJuIHRoaXMubmFtZTtcbiAgfVxuXG4gIHNldERlc2NyaXB0aW9uKGRlc2NyaXB0aW9uKSB7XG4gICAgdGhpcy5kZXNjcmlwdGlvbiA9IGRlc2NyaXB0aW9uO1xuICB9XG5cbiAgZ2V0RGVzY3JpcHRpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMuZGVzY3JpcHRpb247XG4gIH1cblxuICBzZXREYXRlKGR1ZURhdGUpIHtcbiAgICB0aGlzLmR1ZURhdGUgPSBkdWVEYXRlO1xuICB9XG5cbiAgZ2V0RGF0ZSgpIHtcbiAgICByZXR1cm4gdGhpcy5kdWVEYXRlO1xuICB9XG5cbiAgc2V0UHJpb3JpdHkocHJpb3JpdHkpIHtcbiAgICB0aGlzLnByaW9yaXR5ID0gcHJpb3JpdHk7XG4gIH1cblxuICBnZXRQcmlvcml0eSgpIHtcbiAgICByZXR1cm4gdGhpcy5wcmlvcml0eTtcbiAgfVxuXG4gIHNldENhdGVnb3J5KGNhdGVnb3J5KSB7XG4gICAgdGhpcy5jYXRlZ29yeSA9IGNhdGVnb3J5O1xuICB9XG5cbiAgZ2V0Q2F0ZWdvcnkoKSB7XG4gICAgcmV0dXJuIHRoaXMuY2F0ZWdvcnk7XG4gIH1cblxuICBzZXRJRCgpIHtcbiAgICB0aGlzLmlkID0gaWQ7XG4gIH1cblxuICBnZXRJRCgpIHtcbiAgICByZXR1cm4gdGhpcy5pZDtcbiAgfVxufVxuIiwiLy8gVGhlIG1vZHVsZSBjYWNoZVxudmFyIF9fd2VicGFja19tb2R1bGVfY2FjaGVfXyA9IHt9O1xuXG4vLyBUaGUgcmVxdWlyZSBmdW5jdGlvblxuZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkge1xuXHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcblx0dmFyIGNhY2hlZE1vZHVsZSA9IF9fd2VicGFja19tb2R1bGVfY2FjaGVfX1ttb2R1bGVJZF07XG5cdGlmIChjYWNoZWRNb2R1bGUgIT09IHVuZGVmaW5lZCkge1xuXHRcdHJldHVybiBjYWNoZWRNb2R1bGUuZXhwb3J0cztcblx0fVxuXHQvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKVxuXHR2YXIgbW9kdWxlID0gX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fW21vZHVsZUlkXSA9IHtcblx0XHQvLyBubyBtb2R1bGUuaWQgbmVlZGVkXG5cdFx0Ly8gbm8gbW9kdWxlLmxvYWRlZCBuZWVkZWRcblx0XHRleHBvcnRzOiB7fVxuXHR9O1xuXG5cdC8vIEV4ZWN1dGUgdGhlIG1vZHVsZSBmdW5jdGlvblxuXHRfX3dlYnBhY2tfbW9kdWxlc19fW21vZHVsZUlkXShtb2R1bGUsIG1vZHVsZS5leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKTtcblxuXHQvLyBSZXR1cm4gdGhlIGV4cG9ydHMgb2YgdGhlIG1vZHVsZVxuXHRyZXR1cm4gbW9kdWxlLmV4cG9ydHM7XG59XG5cbiIsIi8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb25zIGZvciBoYXJtb255IGV4cG9ydHNcbl9fd2VicGFja19yZXF1aXJlX18uZCA9IChleHBvcnRzLCBkZWZpbml0aW9uKSA9PiB7XG5cdGZvcih2YXIga2V5IGluIGRlZmluaXRpb24pIHtcblx0XHRpZihfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZGVmaW5pdGlvbiwga2V5KSAmJiAhX193ZWJwYWNrX3JlcXVpcmVfXy5vKGV4cG9ydHMsIGtleSkpIHtcblx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBrZXksIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBkZWZpbml0aW9uW2tleV0gfSk7XG5cdFx0fVxuXHR9XG59OyIsIl9fd2VicGFja19yZXF1aXJlX18uZyA9IChmdW5jdGlvbigpIHtcblx0aWYgKHR5cGVvZiBnbG9iYWxUaGlzID09PSAnb2JqZWN0JykgcmV0dXJuIGdsb2JhbFRoaXM7XG5cdHRyeSB7XG5cdFx0cmV0dXJuIHRoaXMgfHwgbmV3IEZ1bmN0aW9uKCdyZXR1cm4gdGhpcycpKCk7XG5cdH0gY2F0Y2ggKGUpIHtcblx0XHRpZiAodHlwZW9mIHdpbmRvdyA9PT0gJ29iamVjdCcpIHJldHVybiB3aW5kb3c7XG5cdH1cbn0pKCk7IiwiX193ZWJwYWNrX3JlcXVpcmVfXy5vID0gKG9iaiwgcHJvcCkgPT4gKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmosIHByb3ApKSIsIi8vIGRlZmluZSBfX2VzTW9kdWxlIG9uIGV4cG9ydHNcbl9fd2VicGFja19yZXF1aXJlX18uciA9IChleHBvcnRzKSA9PiB7XG5cdGlmKHR5cGVvZiBTeW1ib2wgIT09ICd1bmRlZmluZWQnICYmIFN5bWJvbC50b1N0cmluZ1RhZykge1xuXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBTeW1ib2wudG9TdHJpbmdUYWcsIHsgdmFsdWU6ICdNb2R1bGUnIH0pO1xuXHR9XG5cdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsgdmFsdWU6IHRydWUgfSk7XG59OyIsInZhciBzY3JpcHRVcmw7XG5pZiAoX193ZWJwYWNrX3JlcXVpcmVfXy5nLmltcG9ydFNjcmlwdHMpIHNjcmlwdFVybCA9IF9fd2VicGFja19yZXF1aXJlX18uZy5sb2NhdGlvbiArIFwiXCI7XG52YXIgZG9jdW1lbnQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fLmcuZG9jdW1lbnQ7XG5pZiAoIXNjcmlwdFVybCAmJiBkb2N1bWVudCkge1xuXHRpZiAoZG9jdW1lbnQuY3VycmVudFNjcmlwdClcblx0XHRzY3JpcHRVcmwgPSBkb2N1bWVudC5jdXJyZW50U2NyaXB0LnNyY1xuXHRpZiAoIXNjcmlwdFVybCkge1xuXHRcdHZhciBzY3JpcHRzID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJzY3JpcHRcIik7XG5cdFx0aWYoc2NyaXB0cy5sZW5ndGgpIHNjcmlwdFVybCA9IHNjcmlwdHNbc2NyaXB0cy5sZW5ndGggLSAxXS5zcmNcblx0fVxufVxuLy8gV2hlbiBzdXBwb3J0aW5nIGJyb3dzZXJzIHdoZXJlIGFuIGF1dG9tYXRpYyBwdWJsaWNQYXRoIGlzIG5vdCBzdXBwb3J0ZWQgeW91IG11c3Qgc3BlY2lmeSBhbiBvdXRwdXQucHVibGljUGF0aCBtYW51YWxseSB2aWEgY29uZmlndXJhdGlvblxuLy8gb3IgcGFzcyBhbiBlbXB0eSBzdHJpbmcgKFwiXCIpIGFuZCBzZXQgdGhlIF9fd2VicGFja19wdWJsaWNfcGF0aF9fIHZhcmlhYmxlIGZyb20geW91ciBjb2RlIHRvIHVzZSB5b3VyIG93biBsb2dpYy5cbmlmICghc2NyaXB0VXJsKSB0aHJvdyBuZXcgRXJyb3IoXCJBdXRvbWF0aWMgcHVibGljUGF0aCBpcyBub3Qgc3VwcG9ydGVkIGluIHRoaXMgYnJvd3NlclwiKTtcbnNjcmlwdFVybCA9IHNjcmlwdFVybC5yZXBsYWNlKC8jLiokLywgXCJcIikucmVwbGFjZSgvXFw/LiokLywgXCJcIikucmVwbGFjZSgvXFwvW15cXC9dKyQvLCBcIi9cIik7XG5fX3dlYnBhY2tfcmVxdWlyZV9fLnAgPSBzY3JpcHRVcmw7IiwiaW1wb3J0IFRUYXNrIGZyb20gXCIuL3Rhc2syXCI7XG5pbXBvcnQgQ2F0ZWdvcnkgZnJvbSBcIi4vY2F0ZWdvcnlcIjtcblxuaW1wb3J0IG1vb24gZnJvbSBcIi4vaW1ncy9oYWxmLW1vb24ucG5nXCI7XG5pbXBvcnQgc3VuIGZyb20gXCIuL2ltZ3Mvc3VucGl4ZWwucG5nXCI7XG5cbmxldCBzZWxlY3RlZENhdGVnb3J5ID0gXCJhbGwgdGFza3NcIjtcbmxldCBuYW1lSW1wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcIm5hbWVcIik7XG5sZXQgdGhlbWVJY29uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJpY29uXCIpO1xubGV0IGluZm8gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmluZm9cIik7XG5sZXQgYWRkVGFza0J1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY3JlYXRlXCIpO1xubGV0IHRhc2tNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWwtYmdcIik7XG5sZXQgbW9kYWxDbG9zZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWwtY2xvc2VcIik7XG5sZXQgdGFza1N1Ym1pdEJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjc3VibWl0VGFza1wiKTtcbmxldCBjYXRlZ29yeUlucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJjYXRlZ29yeVwiKTtcbmxldCBjYXRlZ29yeUJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCJbY2F0ZWdvcnldXCIpO1xubGV0IGRlbGV0ZUNhdGVnb3J5QnV0dG9ucyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIuY2F0ZWdvcnlkZWxldGVcIik7XG5cbmNvbnN0IGluaXRpYWxMb2FkID0gKCgpID0+IHtcbiAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJsb2FkXCIsICgpID0+IHtcbiAgICAvLyBJbml0aWFsIERhdGUgVXBkYXRlXG4gICAgbGV0IGluaXRpYWxEYXRlID0gbmV3IERhdGUoKTtcbiAgICBsZXQgaW5pdGFsVGltZSA9IGluaXRpYWxEYXRlLnRvTG9jYWxlVGltZVN0cmluZygpO1xuICAgIGluZm8udGV4dENvbnRlbnQgPSBgSXQncyAke2luaXRpYWxEYXRlLnRvRGF0ZVN0cmluZygpfSwgJHtpbml0YWxUaW1lfWA7XG5cbiAgICAvLyBTdG9yYWdlXG5cbiAgICAvLyBVc2VyTmFtZVxuXG4gICAgY29uc3QgdXNlck5hbWUgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShcInVzZXJOYW1lXCIpIHx8IFwiXCI7XG4gICAgbmFtZUltcHV0LnZhbHVlID0gdXNlck5hbWU7XG5cbiAgICBuYW1lSW1wdXQuYWRkRXZlbnRMaXN0ZW5lcihcImNoYW5nZVwiLCAoZSkgPT4ge1xuICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oXCJ1c2VyTmFtZVwiLCBlLnRhcmdldC52YWx1ZSk7XG4gICAgfSk7XG5cbiAgICAvLyBUaGVtZVxuXG4gICAgaWYgKGxvY2FsU3RvcmFnZS5nZXRJdGVtKFwidGhlbWVcIikgPT0gXCJkYXJrLXRoZW1lXCIpIHtcbiAgICAgIGRvY3VtZW50LmJvZHkuY2xhc3NMaXN0LnRvZ2dsZShcImRhcmstdGhlbWVcIik7XG4gICAgICB0aGVtZUljb24uc3JjID0gc3VuO1xuICAgIH0gZWxzZSB7XG4gICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShcInRoZW1lXCIsIFwibm9ybWFsXCIpO1xuICAgICAgdGhlbWVJY29uLnNyYyA9IG1vb247XG4gICAgfVxuXG4gICAgLy8gVGhlbWUgQ2hhbmdlclxuXG4gICAgdGhlbWVJY29uLm9uY2xpY2sgPSBmdW5jdGlvbiAoKSB7XG4gICAgICBkb2N1bWVudC5ib2R5LmNsYXNzTGlzdC50b2dnbGUoXCJkYXJrLXRoZW1lXCIpO1xuICAgICAgaWYgKGRvY3VtZW50LmJvZHkuY2xhc3NMaXN0LmNvbnRhaW5zKFwiZGFyay10aGVtZVwiKSkge1xuICAgICAgICB0aGVtZUljb24uc3JjID0gc3VuO1xuICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShcInRoZW1lXCIsIFwiZGFyay10aGVtZVwiKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoZW1lSWNvbi5zcmMgPSBtb29uO1xuICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShcInRoZW1lXCIsIFwibm9ybWFsXCIpO1xuICAgICAgfVxuICAgIH07XG5cbiAgICAvL0NhdGVnb3J5IElucHV0XG5cbiAgICBjYXRlZ29yeUlucHV0LmFkZEV2ZW50TGlzdGVuZXIoXCJjaGFuZ2VcIiwgKGUpID0+IHtcbiAgICAgIGxldCBjdXJyZW50ID0gbmV3IENhdGVnb3J5KGUudGFyZ2V0LnZhbHVlKTtcbiAgICAgIGxldCBjdXJyZW50Q2F0ZWdvcmllc0luU3RvcmFnZSA9IEpTT04ucGFyc2UoXG4gICAgICAgIGxvY2FsU3RvcmFnZS5nZXRJdGVtKFwiY2F0ZWdvcmllc1wiKVxuICAgICAgKTtcbiAgICAgIGxldCBjYXRlZ29yaWVzID0gY3VycmVudENhdGVnb3JpZXNJblN0b3JhZ2U7XG4gICAgICBjYXRlZ29yaWVzLnB1c2goY3VycmVudCk7XG4gICAgICBzZWxlY3RlZENhdGVnb3J5ID0gZS50YXJnZXQudmFsdWU7XG4gICAgICBjYXRlZ29yeUlucHV0LnZhbHVlID0gXCJcIjtcbiAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKFwiY2F0ZWdvcmllc1wiLCBKU09OLnN0cmluZ2lmeShjYXRlZ29yaWVzKSk7XG5cbiAgICAgIHJlbmRlckNhdGVnb3JpZXMoKTtcbiAgICAgIHVwZGF0ZURvbSgpO1xuICAgICAgY2hhbmdlU2VsZWN0ZWRPblNjcmVlbkNTUygpO1xuICAgIH0pO1xuXG4gICAgLy8gT3BlbiBBZGQgVGFzayBNb2RhbFxuXG4gICAgYWRkVGFza0J1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKGUpIHtcbiAgICAgIHRhc2tNb2RhbC5jbGFzc0xpc3QuYWRkKFwiYWN0aXZlXCIpO1xuICAgIH0pO1xuXG4gICAgLy8gQ2xvc2UgTW9kYWxcblxuICAgIG1vZGFsQ2xvc2UuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uIChlKSB7XG4gICAgICB0YXNrTW9kYWwuY2xhc3NMaXN0LnJlbW92ZShcImFjdGl2ZVwiKTtcbiAgICB9KTtcblxuICAgIC8vIFVwZGF0ZSBUaW1lXG4gICAgc2V0SW50ZXJ2YWwoZnVuY3Rpb24gZ2V0RGlzcGxheVRpbWUoKSB7XG4gICAgICBsZXQgY3VycmVudERhdGUgPSBuZXcgRGF0ZSgpO1xuICAgICAgbGV0IGN1cnJlbnRUaW1lID0gY3VycmVudERhdGUudG9Mb2NhbGVUaW1lU3RyaW5nKCk7XG4gICAgICBpbmZvLnRleHRDb250ZW50ID0gYEl0J3MgJHtjdXJyZW50RGF0ZS50b0RhdGVTdHJpbmcoKX0sICR7Y3VycmVudFRpbWV9YDtcbiAgICB9LCAxMDAwKTtcbiAgfSk7XG5cbiAgLy8gQ2F0ZWdvcnkgU3dpdGNoZXJcbn0pKCk7XG5cbi8vIExvYWQgQ2F0ZWdvcmllcyB0byBET01cblxuZnVuY3Rpb24gbG9hZENhdGVnb3JpZXMoKSB7XG4gIGlmIChsb2NhbFN0b3JhZ2UuZ2V0SXRlbShcImNhdGVnb3JpZXNcIikpIHtcbiAgfSBlbHNlIHtcbiAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShcbiAgICAgIFwiY2F0ZWdvcmllc1wiLFxuICAgICAgSlNPTi5zdHJpbmdpZnkoW3sgY2F0ZWdvcnluYW1lOiBcImFsbCB0YXNrc1wiIH1dKVxuICAgICk7XG4gIH1cbiAgcmVuZGVyQ2F0ZWdvcmllcygpO1xufVxuXG5sb2FkQ2F0ZWdvcmllcygpO1xuXG4vLyBMb2FkIFRhc2tzXG5cbmZ1bmN0aW9uIGxvYWRUYXNrcygpIHtcbiAgaWYgKGxvY2FsU3RvcmFnZS5nZXRJdGVtKFwidGFza3NcIikpIHtcbiAgfSBlbHNlIHtcbiAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShcInRhc2tzXCIsIEpTT04uc3RyaW5naWZ5KFtdKSk7XG4gIH1cbn1cblxubG9hZFRhc2tzKCk7XG5cbi8vIFRhc2sgU3VibWl0IHRvIENyZWF0ZSBUYXNrXG5cbnRhc2tTdWJtaXRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uIChldikge1xuICBldi5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gIGxldCB0YXNraW5wdXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3Rhc2tpbnB1dFwiKTtcbiAgbGV0IHRhc2tpbnB1dERlc2NyaXB0aW9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNkZXNjaW5wdXRcIik7XG4gIGxldCB0YXNraW5wdXREdWUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2R1ZWRhdGVcIik7XG4gIGxldCB0YXNraW5wdXRQcmlvcml0eSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXG4gICAgJ2lucHV0W25hbWU9XCJwcmlvcml0eVwiXTpjaGVja2VkJ1xuICApO1xuXG4gIGxldCB0YXNrbGVuZ3RoID0gdGFza2lucHV0LnZhbHVlLmxlbmd0aDtcbiAgbGV0IGlkID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTAwMDAwMCk7XG4gIGlmICh0YXNrbGVuZ3RoID49IDEpIHtcbiAgICBsZXQgY3VycmVudENyZWF0ZVRhc2sgPSBuZXcgVFRhc2soXG4gICAgICB0YXNraW5wdXQudmFsdWUsXG4gICAgICB0YXNraW5wdXREZXNjcmlwdGlvbi52YWx1ZSxcbiAgICAgIHRhc2tpbnB1dER1ZS52YWx1ZSxcbiAgICAgIHRhc2tpbnB1dFByaW9yaXR5LnZhbHVlLFxuICAgICAgc2VsZWN0ZWRDYXRlZ29yeSxcbiAgICAgIGlkXG4gICAgKTtcblxuICAgIGxldCBjdXJyZW50VGFza3NJblN0b3JhZ2UgPSBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKFwidGFza3NcIikpO1xuXG4gICAgbGV0IHRhc2tzID0gY3VycmVudFRhc2tzSW5TdG9yYWdlO1xuXG4gICAgdGFza3MucHVzaChjdXJyZW50Q3JlYXRlVGFzayk7XG5cbiAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShcInRhc2tzXCIsIEpTT04uc3RyaW5naWZ5KHRhc2tzKSk7XG5cbiAgICB0YXNraW5wdXQudmFsdWUgPSBudWxsO1xuICAgIHRhc2tpbnB1dERlc2NyaXB0aW9uLnZhbHVlID0gbnVsbDtcbiAgICB0YXNraW5wdXREdWUudmFsdWUgPSBudWxsO1xuXG4gICAgdGFza01vZGFsLmNsYXNzTGlzdC5yZW1vdmUoXCJhY3RpdmVcIik7XG4gIH0gZWxzZSB7XG4gICAgdGFza01vZGFsLmNsYXNzTGlzdC5yZW1vdmUoXCJhY3RpdmVcIik7XG4gIH1cbiAgcmVuZGVyVGFza3Moc2VsZWN0ZWRDYXRlZ29yeSk7XG59KTtcblxuLy8gUmVuZGVyIENhdGVnb3JpZXNcblxuZnVuY3Rpb24gcmVuZGVyQ2F0ZWdvcmllcygpIHtcbiAgY29uc3QgY2F0ZWdvcnlEaXNwbGF5ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXRlZ29yeS1kaXNwbGF5XCIpO1xuICBkZWxldGVDYXRlZ29yaWVzKGNhdGVnb3J5RGlzcGxheSk7XG4gIGxldCBjdXJyZW50Q2F0ZWdvcmllcyA9IEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmdldEl0ZW0oXCJjYXRlZ29yaWVzXCIpKTtcbiAgY3VycmVudENhdGVnb3JpZXMuZm9yRWFjaCgoZWxlbWVudCkgPT4ge1xuICAgIGxldCBjYXRlZ29yeUJ1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJidXR0b25cIik7XG4gICAgY2F0ZWdvcnlCdXR0b24uY2xhc3NMaXN0LmFkZChcImNhdGVnb3J5XCIpO1xuICAgIGNhdGVnb3J5QnV0dG9uLnNldEF0dHJpYnV0ZShcImNhdGVnb3J5XCIsIGAke2VsZW1lbnQuY2F0ZWdvcnluYW1lfWApO1xuICAgIGNhdGVnb3J5QnV0dG9uLmlubmVyVGV4dCA9IGVsZW1lbnQuY2F0ZWdvcnluYW1lO1xuICAgIGlmIChlbGVtZW50LmNhdGVnb3J5bmFtZSAhPSBcImFsbCB0YXNrc1wiKSB7XG4gICAgICBsZXQgY2F0ZWdvcnlEZWxldGVTcGFuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInNwYW5cIik7XG4gICAgICBjYXRlZ29yeURlbGV0ZVNwYW4uY2xhc3NMaXN0LmFkZChcImNhdGVnb3J5ZGVsZXRlXCIpO1xuICAgICAgY2F0ZWdvcnlEZWxldGVTcGFuLnNldEF0dHJpYnV0ZShcImlkXCIsIGVsZW1lbnQuY2F0ZWdvcnluYW1lKTtcbiAgICAgIGNhdGVnb3J5RGVsZXRlU3Bhbi5pbm5lclRleHQgPSBcIlhcIjtcbiAgICAgIGNhdGVnb3J5QnV0dG9uLmFwcGVuZENoaWxkKGNhdGVnb3J5RGVsZXRlU3Bhbik7XG4gICAgfVxuICAgIGNhdGVnb3J5RGlzcGxheS5hcHBlbmRDaGlsZChjYXRlZ29yeUJ1dHRvbik7XG4gIH0pO1xuICB1cGRhdGVEb20oKTtcbiAgYWRkQ2F0ZWdvcnlTd2l0Y2hlcigpO1xuICBjYXRlZ29yeURlbGV0ZUxpc3RlbmVyKCk7XG59XG5cbi8vIHVwZGF0ZSBDYXRlZ29yeSBTZWxlY3RvcnMgYW5kIExvYWRlcnNcblxuZnVuY3Rpb24gdXBkYXRlRG9tKCkge1xuICBuYW1lSW1wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcIm5hbWVcIik7XG4gIHRoZW1lSWNvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiaWNvblwiKTtcbiAgaW5mbyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuaW5mb1wiKTtcbiAgYWRkVGFza0J1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY3JlYXRlXCIpO1xuICB0YXNrTW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsLWJnXCIpO1xuICBtb2RhbENsb3NlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5tb2RhbC1jbG9zZVwiKTtcbiAgdGFza1N1Ym1pdEJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjc3VibWl0VGFza1wiKTtcbiAgY2F0ZWdvcnlJbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiY2F0ZWdvcnlcIik7XG4gIGNhdGVnb3J5QnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIltjYXRlZ29yeV1cIik7XG4gIGRlbGV0ZUNhdGVnb3J5QnV0dG9ucyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIuY2F0ZWdvcnlkZWxldGVcIik7XG59XG5cbi8vIERlbGV0ZSBFeGlzdGluZyBDYXRlZ29yaWVzXG5mdW5jdGlvbiBkZWxldGVDYXRlZ29yaWVzKHgpIHtcbiAgd2hpbGUgKHguZmlyc3RDaGlsZCkge1xuICAgIHgucmVtb3ZlQ2hpbGQoeC5maXJzdENoaWxkKTtcbiAgfVxufVxuXG5mdW5jdGlvbiBjaGFuZ2VTZWxlY3RlZE9uU2NyZWVuQ1NTKCkge1xuICBjYXRlZ29yeUJ1dHRvbi5mb3JFYWNoKChidXR0b24pID0+IHtcbiAgICBpZiAoYnV0dG9uLmdldEF0dHJpYnV0ZShcImNhdGVnb3J5XCIpID09IHNlbGVjdGVkQ2F0ZWdvcnkpIHtcbiAgICAgIGJ1dHRvbi5jbGFzc0xpc3QuYWRkKFwic2VsZWN0ZWRWaWV3XCIpO1xuICAgICAgcmVuZGVyVGFza3Moc2VsZWN0ZWRDYXRlZ29yeSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGJ1dHRvbi5jbGFzc0xpc3QucmVtb3ZlKFwic2VsZWN0ZWRWaWV3XCIpO1xuICAgIH1cbiAgfSk7XG59XG5cbmZ1bmN0aW9uIGFkZENhdGVnb3J5U3dpdGNoZXIoKSB7XG4gIGNhdGVnb3J5QnV0dG9uLmZvckVhY2goKGJ1dHRvbikgPT4ge1xuICAgIGJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGUpID0+IHtcbiAgICAgIHNlbGVjdGVkQ2F0ZWdvcnkgPSBlLnRhcmdldC5nZXRBdHRyaWJ1dGUoXCJjYXRlZ29yeVwiKTtcbiAgICAgIGNoYW5nZVNlbGVjdGVkT25TY3JlZW5DU1MoKTtcbiAgICB9KTtcbiAgfSk7XG59XG5cbmNoYW5nZVNlbGVjdGVkT25TY3JlZW5DU1MoKTtcblxuZnVuY3Rpb24gY2F0ZWdvcnlEZWxldGVMaXN0ZW5lcigpIHtcbiAgZGVsZXRlQ2F0ZWdvcnlCdXR0b25zLmZvckVhY2goKGJ1dHRvbikgPT4ge1xuICAgIGJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGUpID0+IHtcbiAgICAgIHNlbGVjdGVkQ2F0ZWdvcnkgPSBcImFsbCB0YXNrc1wiO1xuICAgICAgZGVsZXRlQ2F0ZWdvcnkoZSk7XG4gICAgfSk7XG4gIH0pO1xufVxuXG5mdW5jdGlvbiBkZWxldGVDYXRlZ29yeShlKSB7XG4gIGNvbnN0IGN1cnJlbnRDYXRlZ29yaWVzID0gSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2UuZ2V0SXRlbShcImNhdGVnb3JpZXNcIikpO1xuICBjb25zdCBzZWxlY3RlZENhdGVnb3J5ID0gZS50YXJnZXQuaWQ7XG4gIGxldCBjb3VudCA9IDA7XG4gIGN1cnJlbnRDYXRlZ29yaWVzLmZvckVhY2goKGNhdGVnb3J5KSA9PiB7XG4gICAgaWYgKGNhdGVnb3J5LmNhdGVnb3J5bmFtZSA9PSBzZWxlY3RlZENhdGVnb3J5KSB7XG4gICAgICBjdXJyZW50Q2F0ZWdvcmllcy5zcGxpY2UoY291bnQsIDEpO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb3VudCsrO1xuICAgIH1cbiAgfSk7XG4gIGxvY2FsU3RvcmFnZS5zZXRJdGVtKFwiY2F0ZWdvcmllc1wiLCBKU09OLnN0cmluZ2lmeShjdXJyZW50Q2F0ZWdvcmllcykpO1xuICByZW5kZXJDYXRlZ29yaWVzKCk7XG4gIGRlbGV0ZU9uU2NyZWVuVGFza3MoKTtcbn1cblxuZnVuY3Rpb24gcmVuZGVyVGFza3MoZSkge1xuICBkZWxldGVPblNjcmVlblRhc2tzKCk7XG4gIGNvbnN0IHRhc2tzID0gSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2UuZ2V0SXRlbShcInRhc2tzXCIpKTtcbiAgY29uc3QgdGFza0Rpc3BsYXkgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnRhc2tkaXNwbGF5XCIpO1xuICB0YXNrcy5mb3JFYWNoKCh0YXNrKSA9PiB7XG4gICAgaWYgKHNlbGVjdGVkQ2F0ZWdvcnkgPT0gXCJhbGwgdGFza3NcIikge1xuICAgICAgbGV0IHRhc2tib3ggPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgICAgdGFza2JveC5jbGFzc0xpc3QuYWRkKFwidGFza1wiKTtcblxuICAgICAgbGV0IHRhc2tnZW5lcmFsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICAgIHRhc2tnZW5lcmFsLmNsYXNzTGlzdC5hZGQoXCJ0YXNrZ2VuZXJhbFwiKTtcblxuICAgICAgbGV0IHRhc2t0aXRsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgICB0YXNrdGl0bGUuY2xhc3NMaXN0LmFkZChcInRhc2t0aXRsZVwiKTtcbiAgICAgIHRhc2t0aXRsZS5pbm5lclRleHQgPSBgJHt0YXNrLm5hbWV9YDtcblxuICAgICAgbGV0IHRhc2tkZXNjcmlwdGlvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgICB0YXNrZGVzY3JpcHRpb24uY2xhc3NMaXN0LmFkZChcInRhc2tkZXNjcmlwdGlvblwiKTtcbiAgICAgIHRhc2tkZXNjcmlwdGlvbi5pbm5lclRleHQgPSBgJHt0YXNrLmRlc2NyaXB0aW9ufWA7XG5cbiAgICAgIHRhc2tnZW5lcmFsLmFwcGVuZENoaWxkKHRhc2t0aXRsZSk7XG4gICAgICB0YXNrZ2VuZXJhbC5hcHBlbmRDaGlsZCh0YXNrZGVzY3JpcHRpb24pO1xuICAgICAgdGFza2JveC5hcHBlbmRDaGlsZCh0YXNrZ2VuZXJhbCk7XG5cbiAgICAgIGxldCB0YXNraW5mbyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgICB0YXNraW5mby5jbGFzc0xpc3QuYWRkKFwidGFza2luZm9cIik7XG5cbiAgICAgIGxldCB0YXNrcHJpb3JpdHkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgICAgdGFza3ByaW9yaXR5LmNsYXNzTGlzdC5hZGQoXCJ0YXNrcHJpb3JpdHlcIik7XG4gICAgICB0YXNrcHJpb3JpdHkuaW5uZXJUZXh0ID0gdGFzay5wcmlvcml0eTtcblxuICAgICAgbGV0IHRhc2tkYXRlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICAgIHRhc2tkYXRlLmNsYXNzTGlzdC5hZGQoXCJ0YXNrZGF0ZVwiKTtcbiAgICAgIHRhc2tkYXRlLmlubmVyVGV4dCA9IHRhc2suZHVlRGF0ZTtcblxuICAgICAgdGFza2luZm8uYXBwZW5kQ2hpbGQodGFza3ByaW9yaXR5KTtcbiAgICAgIHRhc2tpbmZvLmFwcGVuZENoaWxkKHRhc2tkYXRlKTtcblxuICAgICAgdGFza2JveC5hcHBlbmRDaGlsZCh0YXNraW5mbyk7XG5cbiAgICAgIGxldCBkZWxldGVidXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYnV0dG9uXCIpO1xuICAgICAgZGVsZXRlYnV0dG9uLnNldEF0dHJpYnV0ZShcImlkXCIsIHRhc2suaWQpO1xuICAgICAgZGVsZXRlYnV0dG9uLmNsYXNzTGlzdC5hZGQoXCJkZWxldGV0YXNrYnV0dG9uXCIpO1xuICAgICAgZGVsZXRlYnV0dG9uLmlubmVyVGV4dCA9IFwiRGVsZXRlXCI7XG5cbiAgICAgIC8vIGxldCBlZGl0QnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImJ1dHRvblwiKTtcbiAgICAgIC8vIGVkaXRCdXR0b24uc2V0QXR0cmlidXRlKFwiaWRcIiwgdGFzay5pZCk7XG4gICAgICAvLyBlZGl0QnV0dG9uLmNsYXNzTGlzdC5hZGQoXCJlZGl0dGFza2J1dHRvblwiKTtcbiAgICAgIC8vIGVkaXRCdXR0b24uaW5uZXJUZXh0ID0gXCJFZGl0XCI7XG5cbiAgICAgIGxldCB0YXNrY2F0ZWdvcnlkaXNwbGF5ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInNwYW5cIik7XG4gICAgICB0YXNrY2F0ZWdvcnlkaXNwbGF5LmlubmVyVGV4dCA9IHRhc2suY2F0ZWdvcnk7XG4gICAgICB0YXNrY2F0ZWdvcnlkaXNwbGF5LmNsYXNzTGlzdC5hZGQoXCJ0YXNrY2F0ZWdvcnlkaXNwbGF5XCIpO1xuXG4gICAgICB0YXNrYm94LmFwcGVuZENoaWxkKGRlbGV0ZWJ1dHRvbik7XG4gICAgICAvLyB0YXNrYm94LmFwcGVuZENoaWxkKGVkaXRCdXR0b24pO1xuICAgICAgdGFza2JveC5hcHBlbmRDaGlsZCh0YXNrY2F0ZWdvcnlkaXNwbGF5KTtcblxuICAgICAgdGFza0Rpc3BsYXkuYXBwZW5kQ2hpbGQodGFza2JveCk7XG5cbiAgICAgIGFkZFRhc2tFdmVudExpc3RlbmVycygpO1xuICAgIH0gZWxzZSBpZiAodGFzay5jYXRlZ29yeSA9PSBzZWxlY3RlZENhdGVnb3J5KSB7XG4gICAgICBsZXQgdGFza2JveCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgICB0YXNrYm94LmNsYXNzTGlzdC5hZGQoXCJ0YXNrXCIpO1xuXG4gICAgICBsZXQgdGFza2dlbmVyYWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgICAgdGFza2dlbmVyYWwuY2xhc3NMaXN0LmFkZChcInRhc2tnZW5lcmFsXCIpO1xuXG4gICAgICBsZXQgdGFza3RpdGxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICAgIHRhc2t0aXRsZS5jbGFzc0xpc3QuYWRkKFwidGFza3RpdGxlXCIpO1xuICAgICAgdGFza3RpdGxlLmlubmVyVGV4dCA9IGAke3Rhc2submFtZX1gO1xuXG4gICAgICBsZXQgdGFza2Rlc2NyaXB0aW9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICAgIHRhc2tkZXNjcmlwdGlvbi5jbGFzc0xpc3QuYWRkKFwidGFza2Rlc2NyaXB0aW9uXCIpO1xuICAgICAgdGFza2Rlc2NyaXB0aW9uLmlubmVyVGV4dCA9IGAke3Rhc2suZGVzY3JpcHRpb259YDtcblxuICAgICAgdGFza2dlbmVyYWwuYXBwZW5kQ2hpbGQodGFza3RpdGxlKTtcbiAgICAgIHRhc2tnZW5lcmFsLmFwcGVuZENoaWxkKHRhc2tkZXNjcmlwdGlvbik7XG4gICAgICB0YXNrYm94LmFwcGVuZENoaWxkKHRhc2tnZW5lcmFsKTtcblxuICAgICAgbGV0IHRhc2tpbmZvID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICAgIHRhc2tpbmZvLmNsYXNzTGlzdC5hZGQoXCJ0YXNraW5mb1wiKTtcblxuICAgICAgbGV0IHRhc2twcmlvcml0eSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgICB0YXNrcHJpb3JpdHkuY2xhc3NMaXN0LmFkZChcInRhc2twcmlvcml0eVwiKTtcbiAgICAgIHRhc2twcmlvcml0eS5pbm5lclRleHQgPSB0YXNrLnByaW9yaXR5O1xuXG4gICAgICBsZXQgdGFza2RhdGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgICAgdGFza2RhdGUuY2xhc3NMaXN0LmFkZChcInRhc2tkYXRlXCIpO1xuICAgICAgdGFza2RhdGUuaW5uZXJUZXh0ID0gdGFzay5kdWVEYXRlO1xuXG4gICAgICB0YXNraW5mby5hcHBlbmRDaGlsZCh0YXNrcHJpb3JpdHkpO1xuICAgICAgdGFza2luZm8uYXBwZW5kQ2hpbGQodGFza2RhdGUpO1xuXG4gICAgICB0YXNrYm94LmFwcGVuZENoaWxkKHRhc2tpbmZvKTtcblxuICAgICAgbGV0IGRlbGV0ZWJ1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJidXR0b25cIik7XG4gICAgICBkZWxldGVidXR0b24uc2V0QXR0cmlidXRlKFwiaWRcIiwgdGFzay5pZCk7XG4gICAgICBkZWxldGVidXR0b24uY2xhc3NMaXN0LmFkZChcImRlbGV0ZXRhc2tidXR0b25cIik7XG4gICAgICBkZWxldGVidXR0b24uaW5uZXJUZXh0ID0gXCJEZWxldGVcIjtcblxuICAgICAgLy8gbGV0IGVkaXRCdXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYnV0dG9uXCIpO1xuICAgICAgLy8gZWRpdEJ1dHRvbi5zZXRBdHRyaWJ1dGUoXCJpZFwiLCB0YXNrLmlkKTtcbiAgICAgIC8vIGVkaXRCdXR0b24uY2xhc3NMaXN0LmFkZChcImVkaXR0YXNrYnV0dG9uXCIpO1xuICAgICAgLy8gZWRpdEJ1dHRvbi5pbm5lclRleHQgPSBcIkVkaXRcIjtcblxuICAgICAgbGV0IHRhc2tjYXRlZ29yeWRpc3BsYXkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic3BhblwiKTtcbiAgICAgIHRhc2tjYXRlZ29yeWRpc3BsYXkuaW5uZXJUZXh0ID0gdGFzay5jYXRlZ29yeTtcbiAgICAgIHRhc2tjYXRlZ29yeWRpc3BsYXkuY2xhc3NMaXN0LmFkZChcInRhc2tjYXRlZ29yeWRpc3BsYXlcIik7XG5cbiAgICAgIHRhc2tib3guYXBwZW5kQ2hpbGQoZGVsZXRlYnV0dG9uKTtcbiAgICAgIC8vIHRhc2tib3guYXBwZW5kQ2hpbGQoZWRpdEJ1dHRvbik7XG4gICAgICB0YXNrYm94LmFwcGVuZENoaWxkKHRhc2tjYXRlZ29yeWRpc3BsYXkpO1xuXG4gICAgICB0YXNrRGlzcGxheS5hcHBlbmRDaGlsZCh0YXNrYm94KTtcbiAgICAgIHVwZGF0ZURvbSgpO1xuICAgICAgYWRkVGFza0V2ZW50TGlzdGVuZXJzKCk7XG4gICAgfVxuICB9KTtcbn1cblxuZnVuY3Rpb24gZGVsZXRlVGFzayhlKSB7XG4gIGNvbnN0IElEID0gZS50YXJnZXQuZ2V0QXR0cmlidXRlKFwiaWRcIik7XG4gIGNvbnN0IHRhc2tzID0gSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2UuZ2V0SXRlbShcInRhc2tzXCIpKTtcbiAgY29uc3QgbmV3VGFza3MgPSB0YXNrcy5maWx0ZXIoKHRhc2spID0+IHRhc2suaWQgIT0gSUQpO1xuICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShcInRhc2tzXCIsIEpTT04uc3RyaW5naWZ5KG5ld1Rhc2tzKSk7XG4gIHJlbmRlclRhc2tzKCk7XG59XG5cbi8vIGZ1bmN0aW9uIGVkaXRUYXNrKGUpIHt9XG5cbmZ1bmN0aW9uIGRlbGV0ZU9uU2NyZWVuVGFza3MoKSB7XG4gIGNvbnN0IHRhc2tEaXNwbGF5ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi50YXNrZGlzcGxheVwiKTtcbiAgd2hpbGUgKHRhc2tEaXNwbGF5LmZpcnN0Q2hpbGQpIHtcbiAgICB0YXNrRGlzcGxheS5yZW1vdmVDaGlsZCh0YXNrRGlzcGxheS5maXJzdENoaWxkKTtcbiAgfVxufVxuXG5mdW5jdGlvbiBhZGRUYXNrRXZlbnRMaXN0ZW5lcnMoKSB7XG4gIGxldCBkZWxldGVCdXR0b25zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5kZWxldGV0YXNrYnV0dG9uXCIpO1xuICAvLyBsZXQgZWRpdEJ1dHRvbnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLmVkaXR0YXNrYnV0dG9uXCIpO1xuICBkZWxldGVCdXR0b25zLmZvckVhY2goKGJ1dHRvbikgPT4ge1xuICAgIGJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGUpID0+IHtcbiAgICAgIGRlbGV0ZVRhc2soZSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIC8vIGVkaXRCdXR0b25zLmZvckVhY2goKGJ1dHRvbikgPT4ge1xuICAvLyAgIGJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGUpID0+IHtcbiAgLy8gICAgIGNvbnNvbGUubG9nKGUudGFyZ2V0LmdldEF0dHJpYnV0ZShcImlkXCIpICsgXCIgZWRpdFwiKTtcbiAgLy8gICB9KTtcbiAgLy8gfSk7XG59XG5cbmV4cG9ydCB7IGluaXRpYWxMb2FkIH07XG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=